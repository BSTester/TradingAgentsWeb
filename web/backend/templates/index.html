<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradingAgents - 多智能体LLM金融交易框架</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
</head>

<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line me-2"></i>
                TradingAgents
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="#analyses" onclick="showAnalyses()">
                    <i class="fas fa-history me-1"></i>
                    分析历史
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container mt-4">
        <!-- Welcome Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h1 class="card-title mb-3">
                            <i class="fas fa-robot me-2"></i>
                            TradingAgents
                        </h1>
                        <p class="card-text">多智能体LLM金融交易框架 - Web界面</p>
                        <p class="card-text">
                            <strong>工作流程:</strong>
                            分析师团队 → 研究团队 → 交易员 → 风险管理 → 投资组合管理
                        </p>
                        <small>由 <a href="https://github.com/TauricResearch" class="text-warning">Tauric Research</a>
                            构建</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Form -->
        <div class="row" id="analysis-form-section">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-cog me-2"></i>
                            配置分析
                        </h5>
                    </div>
                    <div class="card-body">
                        <form id="analysisForm">
                            <!-- Step 1: Ticker Symbol -->
                            <div class="mb-4">
                                <div class="step-header">
                                    <span class="step-number">1</span>
                                    <h6>股票代码</h6>
                                </div>
                                <div class="form-group">
                                    <label for="ticker" class="form-label">输入要分析的股票代码</label>
                                    <input type="text" class="form-control" id="ticker" name="ticker" value="SPY"
                                        placeholder="例如: SPY, AAPL, NVDA" required>
                                </div>
                            </div>

                            <!-- Step 2: Analysis Date -->
                            <div class="mb-4">
                                <div class="step-header">
                                    <span class="step-number">2</span>
                                    <h6>分析日期</h6>
                                </div>
                                <div class="form-group">
                                    <label for="analysis_date" class="form-label">选择分析日期</label>
                                    <input type="date" class="form-control" id="analysis_date" name="analysis_date"
                                        required>
                                </div>
                            </div>

                            <!-- Step 3: Analysts Team -->
                            <div class="mb-4">
                                <div class="step-header">
                                    <span class="step-number">3</span>
                                    <h6>分析师团队</h6>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">选择用于分析的LLM分析师智能体</label>
                                    <div id="analysts-container" class="mt-2">
                                        <!-- Analysts will be populated dynamically -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 4: Research Depth -->
                            <div class="mb-4">
                                <div class="step-header">
                                    <span class="step-number">4</span>
                                    <h6>研究深度</h6>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">选择您的研究深度级别</label>
                                    <div id="research-depth-container" class="mt-2">
                                        <!-- Research depths will be populated dynamically -->
                                    </div>
                                </div>
                            </div>

                            <!-- Step 5: LLM Provider -->
                            <div class="mb-4">
                                <div class="step-header">
                                    <span class="step-number">5</span>
                                    <h6>LLM服务商</h6>
                                </div>
                                <div class="form-group">
                                    <label for="llm_provider" class="form-label">选择要使用的服务</label>
                                    <select class="form-select" id="llm_provider" name="llm_provider" required>
                                        <!-- Providers will be populated dynamically -->
                                    </select>
                                    <div class="mt-2">
                                        <small class="text-muted">后端URL: <span id="backend-url-display"></span></small>
                                    </div>
                                </div>

                                <!-- API Key Input (dynamically shown based on provider) -->
                                <div class="form-group mt-3 section-hidden" id="api-key-container">
                                    <label for="api_key" class="form-label">
                                        <i class="fas fa-key me-1"></i>
                                        API密钥
                                    </label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="api_key" name="api_key"
                                            placeholder="输入您的API密钥...">
                                        <button class="btn btn-outline-secondary" type="button" id="toggle-api-key"
                                            title="切换API密钥可见性" aria-label="切换API密钥可见性">
                                            <i class="fas fa-eye" id="api-key-icon"></i>
                                        </button>
                                        <button class="btn btn-success" type="button" id="validate-api-key"
                                            title="验证API密钥" aria-label="验证API密钥">
                                            <i class="fas fa-check me-1"></i>
                                            验证
                                        </button>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <span id="api-key-help">访问所选LLM服务商需要您的API密钥</span>
                                        </small>
                                    </div>
                                    <div id="api-key-status" class="mt-2"></div>
                                </div>
                            </div>

                            <!-- Step 6: Thinking Agents (Initially Hidden) -->
                            <div class="mb-4 section-hidden" id="thinking-agents-section">
                                <div class="step-header">
                                    <span class="step-number">6</span>
                                    <h6>思维智能体</h6>
                                </div>
                                <div class="alert alert-info">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <strong>API密钥已验证!</strong> 为您的分析选择思维智能体。
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="shallow_thinker" class="form-label">
                                                <i class="fas fa-bolt me-1"></i>
                                                快速思维LLM引擎
                                            </label>
                                            <select class="form-select" id="shallow_thinker" name="shallow_thinker"
                                                required>
                                                <option value="">选择模型...</option>
                                                <!-- Models will be populated dynamically -->
                                            </select>
                                            <small class="text-muted">用于快速初始分析和快速决策。</small>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="deep_thinker" class="form-label">
                                                <i class="fas fa-brain me-1"></i>
                                                深度思维LLM引擎
                                            </label>
                                            <select class="form-select" id="deep_thinker" name="deep_thinker" required>
                                                <option value="">选择模型...</option>
                                                <!-- Models will be populated dynamically -->
                                            </select>
                                            <small class="text-muted">用于全面分析和复杂推理。</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-play me-2"></i>
                                    开始分析
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Progress -->
        <div class="row section-hidden" id="analysis-progress-section">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-spinner fa-spin me-2"></i>
                            分析进行中
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="progress mb-3">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                                id="progress-bar" style="width: 0%" aria-valuenow="0" aria-valuemin="0"
                                aria-valuemax="100" aria-label="分析进度"></div>
                        </div>
                        <div class="alert alert-info" id="current-step">
                            正在初始化分析...
                        </div>

                        <!-- Agent Status Grid -->
                        <div class="row" id="agent-status-grid">
                            <div class="col-12">
                                <h6>智能体状态</h6>
                                <div class="row">
                                    <!-- Analyst Team -->
                                    <div class="col-md-3">
                                        <div class="agent-category">
                                            <h7>分析师团队</h7>
                                            <div class="agent-status" data-agent="market">市场分析师</div>
                                            <div class="agent-status" data-agent="social">社交分析师</div>
                                            <div class="agent-status" data-agent="news">新闻分析师</div>
                                            <div class="agent-status" data-agent="fundamentals">基本面分析师</div>
                                        </div>
                                    </div>
                                    <!-- Research Team -->
                                    <div class="col-md-3">
                                        <div class="agent-category">
                                            <h7>研究团队</h7>
                                            <div class="agent-status" data-agent="bull">多头研究员</div>
                                            <div class="agent-status" data-agent="bear">空头研究员</div>
                                            <div class="agent-status" data-agent="manager">研究经理</div>
                                        </div>
                                    </div>
                                    <!-- Trading Team -->
                                    <div class="col-md-3">
                                        <div class="agent-category">
                                            <h7>交易团队</h7>
                                            <div class="agent-status" data-agent="trader">交易员</div>
                                        </div>
                                    </div>
                                    <!-- Risk Management -->
                                    <div class="col-md-3">
                                        <div class="agent-category">
                                            <h7>风险管理</h7>
                                            <div class="agent-status" data-agent="risky">风险分析师</div>
                                            <div class="agent-status" data-agent="neutral">中性分析师</div>
                                            <div class="agent-status" data-agent="safe">稳健分析师</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-3">
                            <button class="btn btn-secondary" onclick="showAnalysisForm()">
                                <i class="fas fa-arrow-left me-2"></i>
                                返回配置
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Results -->
        <div class="row section-hidden" id="analysis-results-section">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-check-circle me-2 text-success"></i>
                            分析完成
                        </h5>
                    </div>
                    <div class="card-body" id="results-content">
                        <!-- Results will be populated dynamically -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis History -->
        <div class="row section-hidden" id="analysis-history-section">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-history me-2"></i>
                            分析历史
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped" id="history-table">
                                <thead>
                                    <tr>
                                        <th>股票代码</th>
                                        <th>分析日期</th>
                                        <th>状态</th>
                                        <th>时间戳</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <!-- History will be populated dynamically -->
                                </tbody>
                            </table>
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-secondary" onclick="showAnalysisForm()">
                                <i class="fas fa-arrow-left me-2"></i>
                                新分析
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto">TradingAgents</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="关闭通知"></button>
            </div>
            <div class="toast-body" id="toast-body">
                <!-- Toast message will be set dynamically -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
</body>

</html>